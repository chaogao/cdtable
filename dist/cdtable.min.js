/*! cdtable 2016-09-22 */
!function(){var a=['<div data-cd-container="plugin-top"></div>','<div class="cdtable-table-container" data-cd-container="table"></div>','<div data-cd-container="plugin-bottom"></div>'],b='<div class="cdtable-table-empty">没有数据，重新查询</div>',c="STATE_LOADING",d="STAT_LOADED",e=function(a,b){this.option=a,this.$el=$(b).addClass("cdtable-root-container"),this._initEvent()};$.extend(e.prototype,{_initEvent:function(){var a=this;a.$el.on("cdtable.reflow",function(){a.getTable()})},_initView:function(){this.$el.html(a),this.$topPluginContainer=this.$el.find("[data-cd-container=plugin-top]"),this.$bottomPluginContainer=this.$el.find("[data-cd-container=plugin-bottom]"),this.$tableContainer=this.$el.find("[data-cd-container=table]"),$.each(this.addons,function(){this.initView()})},getTable:function(){var a=this;a._isLoading()&&a.ajaxInstance.abort();var b={};$.each(this.addons,function(a){b[a]=this.getAddonData()});var c=a.option.getUrl(b);a._validateUrl(c)&&(a.ajaxInstance=a.option.getAjaxData?a.option.getAjaxData(c):a._getAjaxData(c),a._startLoading(),a.ajaxInstance.done(function(b){var c=a.option.getRowsData(b);a._endLoading(b),c&&c.length?a._render(c,b):a._renderEmpty()}))},_renderEmpty:function(){this.$tableContainer.html(this.option.empty?this.option.empty():b)},_getAjaxData:function(a){return $.ajax({url:a})},_isLoading:function(){return this.__load_state==c},_startLoading:function(){this.__load_state=c,this.$el.addClass("loading"),this.$el.trigger("cdtable.startloading")},_endLoading:function(a){var b=$.Event("cdtable.endloading",{json:a});this.__load_state=d,this.$el.removeClass("loading"),this.$el.trigger(b)},_render:function(a,b){var c,d=this,e="";a.forEach(function(a){var b=d.option.rows(a);e+=b}),c=d.option.isUL?['<ul class="'+(d.option.ulClass||"")+'">',e,"</ul>"].join(""):['<table class="'+(d.option.tableClass||"")+'">',"<thead>",d.option.headerRow(a,b),"</thead>","<tbody>",e,"</tbody>","</table>"].join(""),d.$tableContainer.html(c)},_validateUrl:function(a){return!0},_validateAddon:function(a){var b=!0;return["_addonName","initView","setRoot"].forEach(function(c){return void 0===a[c]?(b=!1,!1):void 0}),b},setAddons:function(a){var b=this;return b.addons={},a.forEach(function(a){b._validateAddon(a)&&(a.setRoot(b),b.addons[a.getName()]=a)}),b._initView(),b}}),$.fn.cdtable=function(a){return a?this.each(function(){var b=new e(a,$(this));$(this).data("cdtable",b)}):this.data("cdtable")},window.cdtable={},window.cdtable.addons={},window.cdtable.tools={}}(),function(){var a={};template=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[c]=a[c]||b(document.getElementById(c).innerHTML);return d?e(d):e},window.cdtable.template=template}(),function(){var a;a={currentPage:0,maxShowPage:10,textLabel:["首页","上一页","下一页","尾页"],pageLabel:"{#0}",preventInitEvent:!1};var b=function(b,c){var d=this;d.element=$(b),d.option=$.extend({},a,c),d.generatePage()};b.Counst={},b.Counst.PAGE_TPL='<div class="mod-page"><% for (var i = 0; i < renderDatas.length; i++) { %><a href="javascript:void(0);" <% if (renderDatas[i].page !== undefined) { %> data-page="<%= renderDatas[i].page %>" <% } %> class="mod-page-item <%= renderDatas[i].className %>"><%= renderDatas[i].label %></a><% } %></div>',$.extend(b.prototype,{generatePage:function(){var a=this,b=a.option;a.generateEvents(),b.pageCount<b.maxShowPage&&(b.maxShowPage=b.pageCount),b.preventInitEvent?a.setPage(b.currentPage):setTimeout(function(){a.setPage(b.currentPage)},0)},setPage:function(a){var b,c,d=this;b=d.getHTML(d.getRenderDatas(a)),d.element.html(b),c=$.Event("page",{page:d.currentPage}),$(d).trigger(c,[{page:d.currentPage}])},getPage:function(){return this.currentPage},generateEvents:function(){var a=this,b=a.element;a.option;b.undelegate("click.page"),b.delegate("[data-page]:not(.mod-page-item-disabled)","click.page",function(b){var c=$(this).data("page");return $.isNumeric(c)?a.setPage(c):"+"==c?a.setPage(a.currentPage+1):"-"==c&&a.setPage(a.currentPage-1),!1})},destory:function(){this.element.undelegate("click.page"),this.element.html("")},destroy:function(){this.destory()},getHTML:function(a){var c;return c=cdtable.template(b.Counst.PAGE_TPL,{renderDatas:a})},getRenderDatas:function(a){var b,c,d,e,f=this,g=f.option,h=[];for(a=parseInt(a),a=0>a?0:a,a=a>g.pageCount-1?g.pageCount-1:a,flag=parseInt(g.maxShowPage/3),b=a-flag<0?0:a-flag,d=a-flag<0?Math.abs(a-flag):0,c=a+(g.maxShowPage-flag)-1>g.pageCount-1?g.pageCount-1:a+(g.maxShowPage-flag)-1,e=a+(g.maxShowPage-flag)-1>g.pageCount-1?Math.abs(a+(g.maxShowPage-flag)-1-(g.pageCount-1)):0,b-=e,c+=d,(0!=a||g.allwaysShow)&&$.each(g.textLabel.slice(0,2),function(b,c){0==b&&c&&h.push({className:0==a?"mod-page-item-first mod-page-item-disabled":"mod-page-item-first",label:c,page:0}),1==b&&c&&h.push({className:0==a?"mod-page-item-prev mod-page-item-disabled":"mod-page-item-prev",label:c,page:"-"})}),b;c>=b;b++)h.push({className:b==a?"mod-page-item-active":"",label:$.isFunction(g.pageLabel)?g.pageLabel(b):g.pageLabel.replace(/{#0}/g,b+1),page:b});return(a!=g.pageCount-1||g.allwaysShow)&&$.each(g.textLabel.slice(2,4),function(b,c){0==b&&c&&h.push({className:a==g.pageCount-1?"mod-page-item-next mod-page-item-disabled":"mod-page-item-next",label:c,page:"+"}),1==b&&c&&h.push({className:a==g.pageCount-1?"mod-page-item-last mod-page-item-disabled":"mod-page-item-last",label:c,page:g.pageCount-1})}),f.currentPage=a,h}}),window.cdtable.tools.Pagination=b}(),function(){var a='<div class="cdtable-date-container"><input class="cdtable-date-start" name="cdtable-date-start" readonly placeholder="<%= placeholderStart %>" /> - <input class="cdtable-date-end" name="cdtable-date-end" readonly placeholder="<%= placeholderEnd %>" /><a href="javascript:void(0);" class="cdtable-date-action"><%= btnRange %></a><a href="javascript:void(0);" class="cdtable-date-remove-action"><%= btnRemove %></a></div>',b={btnRange:"最大日期范围",btnRemove:"清空",placeholderStart:"起始日期",placeholderEnd:"结束日期",startMin:"2015/12/01"},c=function(a){this.option=$.extend({},b,a)};$.extend(c.prototype,{_addonName:"datePicker",getName:function(){return this._addonName},_getContainer:function(){return this.option.container?$(this.option.container):this.root.$topPluginContainer},initView:function(){var a=this,b=a._getContainer();b.append($(a._getHTML())),this.$start=b.find(".cdtable-date-start"),this.$end=b.find(".cdtable-date-end"),this._initDatePlugin(),this._initEvent()},_initDatePlugin:function(){var a=this;a.option.start&&a.option.end&&a._registerDateTimePicker()},_registerDateTimePicker:function(a){var b=this;b._registedPicker||($.datetimepicker.setLocale("zh"),b.$start.datetimepicker({minDate:b.option.startMin,maxDate:new Date(+new Date-864e5),format:"Y-m-d",defaultDate:new Date(+new Date-864e5),timepicker:!1,onSelectDate:function(a,c){b.$end.val()||b.$end.datetimepicker({value:new Date(a.getTime()+864e5)}),b._triggerChange()}}),b.$end.datetimepicker({minDate:b.option.startMin,maxDate:new Date,format:"Y-m-d",defaultDate:new Date,timepicker:!1,onSelectDate:function(a,c){b.$start.val()||b.$start.datetimepicker({value:new Date(a.getTime()-864e5)}),b._triggerChange()}}),b._registedPicker=!0,a&&$(a.target).datetimepicker("show"))},_initEvent:function(){var a=this;a._getContainer().delegate(".cdtable-date-start, .cdtable-date-end","click",function(b){a._registerDateTimePicker(b)}),a._getContainer().delegate(".cdtable-date-remove-action.enable","click",function(b){a.reset(),a._triggerChange(),a._getContainer().find(".cdtable-date-remove-action").removeClass("enable")}),a._getContainer().delegate(".cdtable-date-action","click",function(){a.$start.datetimepicker({value:new Date(a.option.startMin),format:"Y-m-d"}),a.$end.datetimepicker({value:new Date,format:"Y-m-d"}),a._triggerChange()})},_triggerChange:function(){this._getContainer().find(".cdtable-date-remove-action").addClass("enable"),this.root.$el.trigger("cdtable.datepicker.change"),this.root.$el.trigger("cdtable.reflow")},reset:function(){this.$start.val("").datetimepicker("destroy"),this.$end.val("").datetimepicker("destroy"),this._registedPicker=!1},_getHTML:function(){return window.cdtable.template(a,this.option)},setRoot:function(a){this.root=a},getAddonData:function(){return{start:this.$start.val(),end:this.$end.val()}}}),window.cdtable.addons.DatePicker=c}(),function(){var a="<div class=\"cdtable-filter-container\"><ul><% for (var i = 0; i < filters.length; i++) { %><li><span class=\"cdtable-filter-select-name\"><%= filters[i].label %></span><select name='<%= filters[i].name %>'><% for (var j = 0; j < filters[i].datas.length; j++) { %><option value='<%= filters[i].datas[j].value %>'><%= filters[i].datas[j].name %></option><% } %></select></li><% } %></ul></div>",b='<div class="cdtable-filter-container cdtable-filter-container-line"><ul><% for (var i = 0; i < filters.length; i++) { %><li><% if (filters[i].label) { %><div class="cdtable-filter-select-name"><%= filters[i].label %></div><% } %><ul class="cdtable-filter-raw-list"><% for (var j = 0; j < filters[i].datas.length; j++) { %><li data-name="<%= filters[i].name %>" class="cdtable-filter-raw-item <% if (j == 0) { %>cdtable-filter-raw-item-active<% } %>" data-value="<%= filters[i].datas[j].value %>"><a href="javascript:void(0)"><%= filters[i].datas[j].name %></a></li><% } %></ul></li><% } %></ul></div>',c=function(a){this.option=a};$.extend(c.prototype,{_addonName:"filter",getName:function(){return this._addonName},_getContainer:function(){return this.option.container?$(this.option.container):this.root.$topPluginContainer},initView:function(){var a=this,b=a._getContainer();b.append($(a._getHTML())),this._initEvent()},_initEvent:function(){var a=this;a.option.line?(a._getContainer().delegate(".cdtable-filter-raw-item","click",function(){$(this).addClass("cdtable-filter-raw-item-active").siblings().removeClass("cdtable-filter-raw-item-active"),a.root.$el.trigger("cdtable.filter.change"),a.root.$el.trigger("cdtable.reflow")}),a.root.$el.on("cdtable.search.change",function(){a.reset()})):(a._getContainer().delegate("select","change",function(){a.root.$el.trigger("cdtable.filter.change"),a.root.$el.trigger("cdtable.reflow")}),a.root.$el.on("cdtable.search.change",function(){a.reset()}))},_getHTML:function(){var c=this.option.filters,d=this;return d.option.line?window.cdtable.template(b,{filters:c}):window.cdtable.template(a,{filters:c})},setRoot:function(a){this.root=a},reset:function(){this._getContainer().find("select").each(function(){$(this).prop("selectedIndex",0)})},getAddonData:function(){var a={},b=this;return b.option.line?this._getContainer().find(".cdtable-filter-raw-item-active").each(function(){a[$(this).attr("data-name")]=$(this).attr("data-value")}):this._getContainer().find("select").each(function(){a[$(this).prop("name")]=$(this).val()}),a}}),window.cdtable.addons.Filter=c}(),function(){var a='<div class="cdtable-pagination-container"></div>',b=function(a){this.option=a};$.extend(b.prototype,{_addonName:"pagination",getName:function(){return this._addonName},_getContainer:function(){return this.option.container?$(this.option.container):this.root.$bottomPluginContainer},initView:function(){var b=this;b._getContainer().html(a),b._initEvent(),b.root.$el.on("cdtable.endloading",function(a){b._initView(a.json)})},_initView:function(a){var b=this,c=b.option.getSetting(a),d=b._getContainer();!b._pageInstance&&c&&(b._pageInstance=new window.cdtable.tools.Pagination(d.find(".cdtable-pagination-container"),{pageCount:c.total,allwaysShow:!0,maxShowPage:3,preventInitEvent:!0}),$(b._pageInstance).on("page",function(){b.root.$el.trigger("cdtable.reflow")}))},_initEvent:function(){var a=this;a.root.$el.on("cdtable.filter.change cdtable.search.change cdtable.datepicker.change cdtable.rank.change",function(){a.reset()})},reset:function(){this._pageInstance&&this._pageInstance.destory(),this._pageInstance=null},_getHTML:function(){var a=this.option.filters;return window.cdtable.template(TPL_FILTER,{filters:a})},setRoot:function(a){this.root=a},getAddonData:function(){var a=this._pageInstance?this._pageInstance.getPage():0;return a}}),window.cdtable.addons.Pagination=b}(),function(){var a='<div class="cdtable-rank-container"><ul><% for (var i = 0; i < datas.length; i++) { %><li class="cdtable-rank-item" data-rank-key="<%= datas[i].key %>"><span><%= datas[i].name %></span></li><% } %></ul></div>',b=function(a){this.option=a};b.Const={ASC:"asc",DESC:"desc"},$.extend(b.prototype,{_addonName:"rank",getName:function(){return this._addonName},_getContainer:function(){return this.option.container?$(this.option.container):this.root.$topPluginContainer},initView:function(){var a=this,b=a._getContainer();b.append($(a._getHTML())),this._initEvent()},_initEvent:function(){var a=this;a._getContainer().delegate(".cdtable-rank-item","click",function(){a._dealItem($(this))})},_dealItem:function(a){var b=this,c=a.data("rank-key"),d=b._findDataItem(c);if(d){if(b.$activeItems&&b.$activeItems.get(0)!=a.get(0)&&b._resetItem(b.$activeItems),b.$activeItems=a.addClass("cdtable-rank-item-active"),!d.types)return b._triggerChange();var e,f,g=a.data("rank-type"),h=d.types.indexOf(g);e=-1==h?0:h+1==d.types.length?0:h+1;var f=d.types[e];g&&a.removeClass("cdtable-rank-type-"+g),a.addClass("cdtable-rank-type-"+f).data("rank-type",f),b.option.onChange&&b.option.onChange({target:a,type:f}),b._triggerChange()}},_resetItem:function(a){a.removeClass("cdtable-rank-item-active"),a.removeClass("cdtable-rank-type-"+a.data("rank-type")),a.data("rank-type",void 0)},_triggerChange:function(){this.root.$el.trigger("cdtable.rank.change"),this.root.$el.trigger("cdtable.reflow")},_findDataItem:function(a){var b=this.option.datas.filter(function(b){return b.key==a});return b[0]},_getHTML:function(){var b=this.option.datas;return window.cdtable.template(a,{datas:b})},setRoot:function(a){this.root=a},reset:function(){this._getContainer().find("select").each(function(){$(this).prop("selectedIndex",0)})},getAddonData:function(){var a,b=this,c=b._getContainer().find(".cdtable-rank-item-active");return c.length>0&&(a={key:c.data("rank-key"),type:c.data("rank-type")}),a}}),window.cdtable.addons.Rank=b}(),function(){var a='<div class="cdtable-search-container"><input class="cdtable-search-input" value="<%= val %>" placeholder="<%= placeholder %>" /><a href="javascript:void(0);" class="cdtable-search-action"><%= btnText %></a><p class="cdtable-search-error"></p></div>',b={btnText:"搜索",val:"",placeholder:""},c=function(a){this.option=$.extend({},b,a)};$.extend(c.prototype,{_addonName:"search",getName:function(){return this._addonName},_getContainer:function(){return this.option.container?$(this.option.container):this.root.$topPluginContainer},initView:function(){var a=this,b=a._getContainer();b.append($(a._getHTML())),this.$input=b.find(".cdtable-search-input"),this.$error=b.find(".cdtable-search-error").hide(),this._initEvent()},_initEvent:function(){var a=this;a._getContainer().delegate(".cdtable-search-action","click",function(){a.root.$el.trigger("cdtable.search.change"),a.root.$el.trigger("cdtable.reflow")}),a._getContainer().delegate(".cdtable-search-input","keydown",function(b){13==b.keyCode&&(a.root.$el.trigger("cdtable.search.change"),a.root.$el.trigger("cdtable.reflow"))})},reset:function(){this.$input.val("")},_getHTML:function(){return window.cdtable.template(a,this.option)},setRoot:function(a){this.root=a},getAddonData:function(){return this.$input.val()}}),window.cdtable.addons.Search=c}();